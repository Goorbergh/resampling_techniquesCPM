# Simulation study

Each subfolder in this folder contains all files to reproduce a part of the simulation study. All subfolders are structured in the same manner and contain to following
folders:
* Data (optional), contains the data used in the script files
* Script, contains the R scripts to run the simulation
* Output, contains the files that results from running the files in the script folder

This archive structed so that every part of the simulation study can be reproduced independent of the other parts. Therefore, in some cases the data folder of
phase *t*, contains the same files as the output folder of phase *t-1*. What follows next is a short description of every phase in the simulation study, including the 
R packages used in this phase. 

NOTE: the simulation study was executed on a high-performance computing facility running on a Linux- based Operating System (CentOS7). Running this simulation on 
your local machine may not be feasable.

## Phase 1: pre-simulation
In this phase, the beta coefficients used in the DGM are estimated (optim_beta.R), technical details of the estimation procedure can be found in appendix B of the manuscript.
Next, all simulation scenarios were created and stored in a list (simulation_scenatios.R)

## Phase 2: simulation

### 2A
In this phase, the following steps were taken:

1. Generation of development and validation data. Functions in data_generation.R
2. Using resampling techniques to create balanced data sets. Functions in imbalance_functions.R
3. Fitting all models on development data. Functions in fitting_models.R
4. Estimate performance on validation data. Functions in model_validation_wo_xgb_ECI.R

All these steps are bound together for a single run in single_run_wo_eci.R. The full simulation is ran by using simulation_run.R. The sim_run.sh file contains
a script to run the simulation of 24 cores simultaniously using a SLURM wordload manager. The results of the simulation are stored under the folder Output/OUT.

### 2B
To bind the results in Output/OUT, the script in result_binding_code.R can be used. This script generates 8 .RDS files containing simulations with the same 
number of predictors and sample size, but with all prevalence levels (0.3, 0.1, 0.01). These files can be found in the Output folder under the name:
res_<scenario prevalence 0.3>_<scenario prevalence 0.1>_<scenario prevalence 0.01>.RDS

## Phase 3: Post simulation data separation
Because the separation check in the original simulation was not executed correctly, a post simulation separation check was conducted. The same data was generated 
using the same seds as in phase 2. The seperation was checked for using the function defined in the seperation_detection.R script. The separation detection
can be executed using the separation_simulation.R script, in combination with sim_sep_run.sh when using a HPC. The results of this simulation are stored in Output/OUT_separation.

To remove separated data sets, run the remove_separated_data.R script. This results in the same files as phase 2B, but with the separated data sets removed.
These files go under the name data_<scenario prevalence 0.3>_<scenario prevalence 0.1>_<scenario prevalence 0.01>.RDS and are stored in the Output folder.

## Phase 4: Analyses
The performance of all scenarios is averaged using the median. The figures and tables that are in the results section of the main part of the thesis can be generated by running the
restults_figures_tables.R script. The figure visualising the resampling techniques (Figure 2) can be generated running the imbalance_visualisation.R script. All
figures and tables in the supplementary material can be generated running the supplementary_material_code.R script.


